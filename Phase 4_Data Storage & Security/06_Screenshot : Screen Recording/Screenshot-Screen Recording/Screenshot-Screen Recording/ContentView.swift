//üîí ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Screenshot / Screen Recording?
//
//‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÄ‡∏ä‡πà‡∏ô:
//‡∏£‡∏´‡∏±‡∏™ OTP
//‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï
//‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)
//‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
//‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ (K PLUS, SCB EASY, TrueMoney)
//‡∏à‡∏∞‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≠ ‡∏î‡∏≥ (black overlay) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÅ‡∏Ñ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠

//‚öôÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Screenshot / Recording ‡∏î‡πâ‡∏ß‡∏¢ Secure UIWindow
//Apple ‡πÑ‡∏°‡πà‡∏°‡∏µ API ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‚Äú‡∏´‡πâ‡∏≤‡∏° Screenshot‚Äù
//‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£ render UI ‡πÉ‡∏ô buffer ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡πÑ‡∏î‡πâ
//‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ secure window ‡∏ú‡πà‡∏≤‡∏ô UISecureTextField ‡∏´‡∏£‡∏∑‡∏≠ UIWindow custom flag

//‚öôÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö Screen Recording (‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
//‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà iOS 11+ ‡∏°‡∏µ API ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

//‚öôÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Screenshot (‡πÅ‡∏ö‡∏ö‡∏à‡∏≥‡∏Å‡∏±‡∏î)
//Apple ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡∏ö‡∏•‡πá‡∏≠‡∏Å Screenshot ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏î‡πâ‡∏≤‡∏ô UX ‡πÅ‡∏•‡∏∞ Privacy)
//‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‚Äù ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Notification (‡πÑ‡∏°‡πà‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£)

//‚öôÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 4: ‡πÉ‡∏ä‡πâ Layer Rendering ‡πÅ‡∏ö‡∏ö Secure (‡πÄ‡∏â‡∏û‡∏≤‡∏∞ UIView)
//‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏≠‡∏Å iOS ‡∏ß‡πà‡∏≤ ‚Äú‡∏´‡πâ‡∏≤‡∏° snapshot‚Äù UIView ‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÑ‡∏î‡πâ
//‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ property layer.isOpaque ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£ render ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô
//‡πÅ‡∏ï‡πà API ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠ UITextField.isSecureTextEntry
//(‡∏ã‡∏∂‡πà‡∏á Apple ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô ‚Äî ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ Screenshot ‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤)
//‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏ö‡∏≤‡∏á TextField
//‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ isSecureTextEntry = true
//‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å iOS ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô sensitive content

//let textField = UITextField()
//textField.isSecureTextEntry = true

//‚öôÔ∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 5: ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏ô SwiftUI
//‡πÉ‡∏ô SwiftUI ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ API ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
//‡πÅ‡∏ï‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ UIKit integration (UIViewControllerRepresentable) ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:

//    üß† ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ background
//üì± ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏≠‡∏õ ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô multitasking preview
//    func sceneWillResignActive(_ scene: UIScene) {
//        let blurEffect = UIBlurEffect(style: .regular)
//        let blurView = UIVisualEffectView(effect: blurEffect)
//        blurView.frame = window?.bounds ?? .zero
//        blurView.tag = 777
//        window?.addSubview(blurView)
//    }
//
//    func sceneDidBecomeActive(_ scene: UIScene) {
//        window?.viewWithTag(777)?.removeFromSuperview()
//    }

import SwiftUI

//‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ üòÖ
//‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ‚Äú‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏à‡∏£‡∏¥‡∏á‚Äù ‡∏Ñ‡∏∑‡∏≠‡πÉ‡∏ä‡πâ UIScreen API ‡∏Ñ‡∏£‡∏±‡∏ö üëá
class SecureWindow: UIWindow {
    override func didAddSubview(_ subview: UIView) {
        super.didAddSubview(subview)
        layer.superlayer?.addSublayer(CAReplicatorLayer()) // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô screen capture
    }
}

//‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô ViewController
//üîê ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‚Üí ‡∏à‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡∏î‡∏≥‚Äù
//‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î ‚Üí ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏õ‡∏Å‡∏ï‡∏¥
class SecureViewController: UIViewController {
    override func viewDidLoad() {
        super.viewDidLoad()
        view.backgroundColor = .systemBackground
        setupScreenRecordingDetection()
        setupScreenshotNotification()
    }

    func setupScreenRecordingDetection() {
        NotificationCenter.default.addObserver(
            self,
            selector: #selector(checkRecording),
            name: UIScreen.capturedDidChangeNotification,
            object: nil
        )
        checkRecording() // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
    }
    
    //    üß© ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‚Äú‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‚Äù ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
    //    ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ ‚Äú‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‚Äù ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á 100%
        func setupScreenshotNotification() {
            NotificationCenter.default.addObserver(
                forName: UIApplication.userDidTakeScreenshotNotification,
                object: nil,
                queue: .main
            ) { _ in
                print("üì∏ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠!")
                // ‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô, ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•, ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≠‡∏î‡∏≥
            }
        }

    @objc func checkRecording() {
        if UIScreen.main.isCaptured {
            print("‚ö†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠")
            showBlackOverlay()
        } else {
            print("‚úÖ ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠")
            hideBlackOverlay()
        }
    }

    func showBlackOverlay() {
        let overlay = UIView(frame: view.bounds)
        overlay.backgroundColor = .black
        overlay.tag = 999
        view.addSubview(overlay)
    }

    func hideBlackOverlay() {
        view.viewWithTag(999)?.removeFromSuperview()
    }
}

struct SecureViewControllerWrapper: UIViewControllerRepresentable {
    func makeUIViewController(context: Context) -> SecureViewController {
        return SecureViewController()
    }
    func updateUIViewController(_ uiViewController: SecureViewController, context: Context) {}
}

struct ContentView: View {
    var body: some View {
        SecureViewControllerWrapper()
            .edgesIgnoringSafeArea(.all)
    }
    
//    üîç UIScreen.main.isCaptured
//    ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô true ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ screen recording ‡∏´‡∏£‡∏∑‡∏≠ AirPlay ‡∏ó‡∏µ‡πà capture ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏≠‡∏¢‡∏π‡πà
    func setupNotification() {
        NotificationCenter.default.addObserver(
            forName: UIScreen.capturedDidChangeNotification,
            object: nil,
            queue: .main
        ) { _ in
            if UIScreen.main.isCaptured {
                print("‚ö†Ô∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏≠‡∏¢‡∏π‡πà!")
                // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≠‡∏î‡∏≥ ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            } else {
                print("‚úÖ ‡∏´‡∏¢‡∏∏‡∏î‡∏≠‡∏±‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏•‡πâ‡∏ß")
            }
        }
    }
    


}

#Preview {
    ContentView()
}
